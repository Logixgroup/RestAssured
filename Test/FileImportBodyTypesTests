import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.node.ObjectNode;
import io.restassured.http.ContentType;
import org.testng.annotations.BeforeClass;
import org.testng.annotations.Test;

import java.util.Map;

public class FileImportBodyTypesTests {

    private String fileImportUrl;
    private Map<String, String> headers;
    private ObjectMapper mapper;

    @BeforeClass
    public void init() {
        String baseUrl = "https://api.yourdomain.com";
        fileImportUrl = baseUrl + "/v1/file-import";

        String bearerToken = "Bearer " + "sampleToken123";

        headers = Map.of(
                "Authorization", bearerToken,
                "Content-Type", "application/json"
        );

        mapper = new ObjectMapper();
    }

    // ============================================================
    // 1️⃣ TESTCASE — JSON STRING BODY
    // ============================================================

    @Test
    public void testUsingJsonString() {

        String finalBody = "{ \"fiId\": \"FI12345\", \"memberNumber\": \"10001\" }";

        io.restassured.RestAssured
                .given()
                .headers(headers)
                .contentType(ContentType.APPLICATION_JSON.getMimeType())
                .body(finalBody)
            .when()
                .post(fileImportUrl)
            .then()
                .statusCode(200);
    }

    // ============================================================
    // 2️⃣ TESTCASE — JAVA MAP BODY
    // ============================================================

    @Test
    public void testUsingJavaMap() {

        Map<String, Object> finalBody = Map.of(
                "fiId", "FI67890",
                "memberNumber", "20002"
        );

        io.restassured.RestAssured
                .given()
                .headers(headers)
                .contentType(ContentType.APPLICATION_JSON.getMimeType())
                .body(finalBody)
            .when()
                .post(fileImportUrl)
            .then()
                .statusCode(200);
    }

    // ============================================================
    // 3️⃣ TESTCASE — JACKSON OBJECTNODE
    // ============================================================

    @Test
    public void testUsingObjectNode() {

        ObjectNode finalBody = mapper.createObjectNode();
        finalBody.put("fiId", "FI88888");
        finalBody.put("memberNumber", "30003");

        io.restassassured.RestAssured
                .given()
                .headers(headers)
                .contentType(ContentType.APPLICATION_JSON.getMimeType())
                .body(finalBody)
            .when()
                .post(fileImportUrl)
            .then()
                .statusCode(200);
    }

    // ============================================================
    // 4️⃣ TESTCASE — POJO
    // ============================================================

    public static class FileImportRequest {
        private String fiId;
        private String memberNumber;

        public FileImportRequest(String fiId, String memberNumber) {
            this.fiId = fiId;
            this.memberNumber = memberNumber;
        }

        public String getFiId() { return fiId; }
        public String getMemberNumber() { return memberNumber; }
    }

    @Test
    public void testUsingPOJO() {

        FileImportRequest finalBody = new FileImportRequest("FI99999", "40004");

        io.restassured.RestAssured
                .given()
                .headers(headers)
                .contentType(ContentType.APPLICATION_JSON.getMimeType())
                .body(finalBody)
            .when()
                .post(fileImportUrl)
            .then()
                .statusCode(200);
    }
}
